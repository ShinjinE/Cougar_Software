
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Changing Movement Range &#8212; Cosmotron 2021 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Changing the Movement Map" href="mapchange.html" />
    <link rel="prev" title="Accessing the Raspberry Pi" href="access.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="changing-movement-range">
<h1>Changing Movement Range<a class="headerlink" href="#changing-movement-range" title="Permalink to this headline">¶</a></h1>
<p>There are two loactions that the range of the outputs can be adjusted. The first is
in Python code and the second is in the settings of the Pololu Maestro Board. These
two sources do not change the range in the same way. The Python code determines the
output value used in order to move the motors. The Maestro board provides a limit to
the allowable range for each output channel. If the Maestro board receives an output
that is outside its defined range, it will limit the value to the edge of its range.
So the settings on the Maestro functions more like a safety in how the Maestro board
is being utilized for Cosmotron and the Python code defines the range which impacts
how the input values from the PlayStation 4 (PS4) Dual Shock controllers are mapped
to the output values. How to change both are outlined in the following sections.</p>
<div class="section" id="defining-output-ranges-in-python-code">
<span id="pyrange"></span><h2>Defining Output Ranges in Python Code<a class="headerlink" href="#defining-output-ranges-in-python-code" title="Permalink to this headline">¶</a></h2>
<p>The class, MovementMap, contained in the file MovementMap.py, is were the ranges for
each output is defined. Thes values are defined in the beginning of the class’
constructor. Output objects are created for each movement group. After each object is
created, it has it’s minimum, default, and maximum output values defined by using the
set_outputs method of the output object. The object is then added to a list used for
a sequential startup of the Maestro channels, but this is irrelavant to the output
ranges. The following code block is an excerpty from MovementMap.py:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>78
79
80
81
82
83
84
85
86</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Left Ear</span>
<span class="bp">self</span><span class="o">.</span><span class="n">left_ear</span> <span class="o">=</span> <span class="n">EarOutput</span><span class="p">(</span><span class="s2">&quot;left ear&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;down_button_1&quot;</span><span class="p">,</span> <span class="s2">&quot;left_button_1&quot;</span><span class="p">])</span>
<span class="bp">self</span><span class="o">.</span><span class="n">left_ear</span><span class="o">.</span><span class="n">set_outputs</span><span class="p">([</span><span class="mi">4000</span><span class="p">],</span> <span class="p">[</span><span class="mi">4000</span><span class="p">],</span> <span class="p">[</span><span class="mi">8000</span><span class="p">])</span>
<span class="bp">self</span><span class="o">.</span><span class="n">output_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_ear</span><span class="p">)</span>

<span class="c1"># Eyelids</span>
<span class="bp">self</span><span class="o">.</span><span class="n">eyelids</span> <span class="o">=</span> <span class="n">AnalogOutputObject</span><span class="p">(</span><span class="s2">&quot;eylids&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="bp">self</span><span class="o">.</span><span class="n">eyelids</span><span class="o">.</span><span class="n">set_outputs</span><span class="p">([</span><span class="mi">6800</span><span class="p">,</span> <span class="mi">5300</span><span class="p">],</span> <span class="p">[</span><span class="mi">6800</span><span class="p">,</span> <span class="mi">5300</span><span class="p">],</span> <span class="p">[</span><span class="mi">6050</span><span class="p">,</span> <span class="mi">6550</span><span class="p">])</span>
<span class="bp">self</span><span class="o">.</span><span class="n">output_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eyelids</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>This format is used for each movement group contained in the MovementMap class. To
accomodate the varying circumstances of each movement group and how many motors it
will output to, the inputs to the set_outputs method takes three lists. The first
list contains the minimum output values. The second list contains the default output
values which are used on startup to match the motors with the default inputs from
PS4 controllers and for some complicated movement groups. The third list contains
the maximum output values.</p>
<p>The code above provides two examples of setting the range. One with only one output
channel and one with two output channels. The number of output channels, as well as
which channels to output to, are determined by the inputs passed to the constructor
of the output object. The exact inputs differ depending on the output object, but
each output object constructor takes the same first three inputs. These are, in
order, movement group name, number of output channels, and which channels to output
to.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Order of the elements in the list matters.</p>
</div>
<p>The number of elements in each list passed to the set_outputs method needs to match
the number output channels for that object. So for the left ear, which only has one
output, each list has one value which correspond directly to the max, default, and min
output values. The eyelids have two outputs, so each list in the set_outputs method has
two values. For these situations with more than one output for the movement group, the
order of the values in each list matters. The first value in the min, default, and max
lists corresponds to the first value in the list defining the output channels. The
second value in the min, default, and max lists corresponds to the second value in the
list defining the output channels and so on.</p>
<p>This means that for the left ear, it only sends outputs to channel one on the Maestro
board. The minimum value that is output is 4000 and the maximum is 8000. By default,
the value 4000 is sent to this channel.</p>
<p>Looking at the eyelids, this movement group outputs to channels 2 and 3 on the
Maestro. For channel 2, the minimum value is 6800 and the max is 6050. For channel
3, the minimum value is 5300 and the max is 6550. The defaults for channels 2 and 3
are 6800 and 5300 respectively.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>117
118
119
120</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># Right Lip</span>
<span class="bp">self</span><span class="o">.</span><span class="n">right_lip</span> <span class="o">=</span> <span class="n">SideLipOutput</span><span class="p">(</span><span class="s2">&quot;right lip&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;circle_button_2&quot;</span><span class="p">,</span> <span class="s2">&quot;x_button_2&quot;</span><span class="p">])</span>
<span class="bp">self</span><span class="o">.</span><span class="n">right_lip</span><span class="o">.</span><span class="n">set_outputs</span><span class="p">([</span><span class="mi">6500</span><span class="p">,</span> <span class="mi">5000</span><span class="p">],</span> <span class="p">[</span><span class="mi">6000</span><span class="p">,</span> <span class="mi">6000</span><span class="p">],</span> <span class="p">[</span><span class="mi">5500</span><span class="p">,</span> <span class="mi">7000</span><span class="p">])</span>
<span class="bp">self</span><span class="o">.</span><span class="n">output_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_lip</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Here is another example to illustrate that sometimes the minimum value is set higher
than the maximum value. Doing this “inverts” the output. More specifially, a minimum
input value maps to the value set as the minimum for the output value. The same goes
for the maximums. Maximum input value maps to the value set for the maximum output
value. So the right lip outputs to channels 14 and 15 (set by the list [14, 15]
passed to the constructor). Channel 14 has its minimum output set to 6050 and its
maximum output set to 5500. Channel 15 has its minimum output set to 5000 and its
maximum output set to 7000. The defaults for channels 14 and 15 are both 6000.</p>
</div>
<div class="section" id="defining-output-limits-in-maestro-settings">
<h2>Defining Output Limits in Maestro Settings<a class="headerlink" href="#defining-output-limits-in-maestro-settings" title="Permalink to this headline">¶</a></h2>
<p><strong>Maestro Servo Controller</strong></p>
<p>There are two main ways to change the range limits for the Maestro board. One is
to use the Maestro Control Center software. The other is to use UscCmd command
line software that comes with the linux-maestro files. Ultimately, both depend on
loading or modifying a settings file. The control center software is a GUI that
lets you change the settings interactively and thus is more user friendly.</p>
<p>As mentioned, the most user friendly option to change the channel range limits is
through the control center software. This can be download for the needed operating
system from the <a class="reference external" href="https://www.pololu.com/docs/0J40/all#3">Maestro user manual on Pololu’s website</a>. Any questions on how to use the
control center properly that is not answered by this document for Cosmotron can be
found in the user manual for the Maestro board from Pololu.</p>
<div class="figure align-default" id="id1">
<img alt="_images/MaestroControlCenter.png" src="_images/MaestroControlCenter.png" />
<p class="caption"><span class="caption-text">The status tab of the Maestro Control Center GUI</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>The two main tabs on the control center that are important for configuring settings
are the following:</p>
<ul class="simple">
<li><p>Channel Settings</p></li>
<li><p>Serial Settings</p></li>
</ul>
<p>In the <em>Channel Settings</em> tab you are able to set the min and max allowable pulse
range, in microseconds, of each output channel. In the <em>Serial Settings</em> tab, the
serial mode must be set to <em>USB Dual Port</em> in order for the commands to be properly
sent from the Raspberry Pi.</p>
<p>The changes to the settings are applied to the Maestro board by clicking on the
<em>Apply Settings</em> button on the bottom right part of the control center window.
These settings persist on the board until they are changed again in the control
center or by loading a settings file. The settings file is generated by selecting
the <em>Save settings file…</em> option in the File drop down menu at the top of the
control center. To load a settings file, use the <em>Open settings file…</em> option
from the same menu. It is recommended to keep a file of the desired settings on
the Maestro used for Cosmotron in case the Maestro board needs to be changed.</p>
<p>The settings file is a simple text file that can easily be edited using any text
editor. It uses tags like HTML to specify the different settings and their values.</p>
<p><strong>Tic Stepper Driver Boards</strong></p>
<p>It is important to mention the Tic Stepper Motor Driver boards in this section
since they also have settings that impact the motor movement of the few stepper
motors being used. The Tic boards also use settings files that can be saved and
loaded like the Maestro boards do. There is also control center software that is
used to set the settings on the Tic board. The software can be found for various
operating systems in the <a class="reference external" href="https://www.pololu.com/docs/0J71/all#3">Tic user manual on Pololu’s website</a>.</p>
<p>Currently, the Tic boards have their <em>Control Mode</em> set to <em>RC Position Control</em>
so the steppers are moved to specific positions based off of the output the Tic
board receives from the Maestro board. The settings for this mode are set in the
<em>RC and analog scaling</em> section of the <em>Input and motor settings</em> tab. Using the
learn button, the min, neutral, and max values can be set for what the Maestro
board is set to output. However, the important setting that really determines the
range of outputs for the steppers is the target values for the min and max inputs.
These targets correlate to the position of the motor. If the target for minimum
input is set to -200 and the target for maximum input is set to 200, the motor will
travel 400 steps to go between the minimum and maximum positions.</p>
<div class="figure align-default" id="id2">
<img alt="_images/TicControlCenter.png" src="_images/TicControlCenter.png" />
<p class="caption"><span class="caption-text">The Input and motor settings tab of the Tic Control Center</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To connect Cosmotron’s Maestro to a computer, the USB port in Cosmotron’s
access panel can be used. However, to connect to the Tic boards in order to
change their settings, the boards must currently be removed from inside
Cosmotron.</p>
<p>The Maestro has a USB-B Mini port, but the access panel it is connected to
has a USB-A port. The Tic boards have a USB-Micro port. Before trying to change
settings on either board make sure you have the proper USB cable.</p>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Cosmotron</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="technical.html">Technical Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="access.html">Accessing the Raspberry Pi</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Changing Movement Range</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#defining-output-ranges-in-python-code">Defining Output Ranges in Python Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#defining-output-limits-in-maestro-settings">Defining Output Limits in Maestro Settings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mapchange.html">Changing the Movement Map</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="input.html">Input Event Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="mapping.html">Movement Mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="output.html">Output Objects</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="technical.html">Technical Manual</a><ul>
      <li>Previous: <a href="access.html" title="previous chapter">Accessing the Raspberry Pi</a></li>
      <li>Next: <a href="mapchange.html" title="next chapter">Changing the Movement Map</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Parker King, Ethan Harris.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.5.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/range.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>